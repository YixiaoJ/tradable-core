/******  Copyright 2016 Tradable ApS; @license MIT; v1.16.1  ******/
function isGreaterOrEqualMinVersion(e,n){return this.toNum=function(e){return parseInt(e,10)},this.highest=function(e,n){for(var t=e.split(".").map(this.toNum),o=n.split(".").map(this.toNum),r=0;r<t.length;r++)if(t[r]!==o[r])return t[r]>o[r]?e:n;return o.length>t.length?n:void 0},"undefined"==typeof highest(e,n)||highest(e,n)!==n?!0:!1}"undefined"==typeof jQuery?console.warn("tradable requires jQuery to run"):isGreaterOrEqualMinVersion(jQuery.fn.jquery,"2.1.4")||console.warn("tradable requires jQuery version 2.1.4 or above");var trEmbJQ=jQuery.noConflict(!0),jsGlobalObject="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:this;!function(e,n){"use strict";function t(){function e(e,t){var o,r,c;t.tradingEnabled=!1,i()&&localStorage.setItem("tradingEnabled:"+x,!1);var a=e.replace("#","").split("&");return n(a).each(function(e,n){var t=n.split("="),a=t[0],i=t[1];"access_token"===a?o=i:"endpointURL"===a?r=i:"expires_in"===a&&(c=i)}),o&&r?(t.enableTrading(o,r,c),"osLaunch"===window.name&&window.close(),!0):!1}var t=!1,o=window.opener;if(o&&"osBrokerSignUp"===window.name)window.close();else if(o&&"osLaunch"===window.name){var r=window.location.hash;if(r){try{o.postMessage("replace your location","*"),t=e(r,o.tradable)}catch(c){t=!1}t||(t=e(r,H))}}else window.location.hash&&-1!==window.location.hash.indexOf("access_token")&&-1!==window.location.hash.indexOf("endpointURL")&&-1!==window.location.hash.indexOf("expires_in")?t=e(window.location.hash,H):H.tradingEnabled&&(T(),t=!0);t||(console.log("Initiating without authentication..."),n(document).ready(function(){O()}))}function o(){var t="undefined"!=typeof e.tradableEmbedConfig?e.tradableEmbedConfig:e.tradableConfig;if("undefined"==typeof t){var o=0!==n("#tradable-embed").length?"#tradable-embed":0!==n("#tradable").length?"#tradable":"#tradable-api";t={appId:n(o).attr("data-app-id"),redirectURI:n(o).attr("data-redirect-uri"),customOAuthURL:n(o).attr("data-custom-oauth-url"),customOAuthHost:n(o).attr("data-custom-oauth-host")}}return t}function r(){var e=tradableConfig.redirectURI?tradableConfig.redirectURI:location.href;return encodeURIComponent(e)}function c(e){var n={},t=tradableConfig.customOAuthURL,o=tradableConfig.customOAuthHost,r="api.tradable.com/";x>2e5&&(r="api-staging.tradable.com/",console.log("Starting in staging mode...")),o&&(r=o);var c="https://"+r+"oauth/authorize?client_id="+x+"&scope=trade&response_type=token&redirect_uri="+e,a=t?t:c;return n.oauthHost=r,n.oauthURL=a,n}function a(){var e={};return e.token=localStorage.getItem("accessToken:"+x),e.authEndpoint=localStorage.getItem("authEndpoint:"+x),e.tradingEnabled=localStorage.getItem("tradingEnabled:"+x),e.expirationTimeUTC=localStorage.getItem("expirationTimeUTC:"+x),!e.tradingEnabled||e.authEndpoint&&e.token&&e.expirationTimeUTC||(e.tradingEnabled=!1,i()&&localStorage.setItem("tradingEnabled:"+x,e.tradingEnabled)),e}function i(){var e="test";try{return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch(n){return!1}}function u(e,n){var t=window.screenLeft?window.screenLeft:window.screenX,o=window.screenTop?window.screenTop:window.screenY,r=420,c=500,a=t+window.innerWidth/2-r/2,i=o+window.innerHeight/2-c/2;return window.open(e,n,"toolbar=no, titlebar=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+r+", height="+c+", top="+i+", left="+a)}function s(e,n){var t=!1;return H.tradingEnabled&&(H.tradingEnabled=!1,t=!0),g(),m().then(function(n){return console.log("Instruments ready"),t&&(H.tradingEnabled=!0,C()),e&&"function"==typeof e?e(H.accounts):this},function(e){return n&&"function"==typeof n?n(e):this})}function l(e,n){return d(H.selectedAccountId,e,n)}function d(e,n,t){return H.makeAccountRequest("GET",e,"instruments/",null,n,t)}function f(){return"FULL_INSTRUMENT_LIST"===H.selectedAccount.instrumentRetrieval}function p(e){var t=!0;return n(H.accounts).each(function(n,o){o.uniqueId===e&&"FULL_INSTRUMENT_LIST"!==o.instrumentRetrieval&&(t=!1)}),t}function m(){var e=new n.Deferred;if(f())l().then(function(n){A(n),e.resolve(H.availableInstruments)});else{var t=[];Q=[],t.push(H.searchInstruments("EUR").then(h)),t.push(H.searchInstruments("AUD").then(h)),t.push(H.searchInstruments("USD").then(h)),n.when.apply(null,t).done(function(){H.getPrices(Q).then(function(){e.resolve(H.availableInstruments)})})}return e}function h(e){n(e).each(function(e,n){(6===n.symbol.length||7===n.symbol.length)&&Q.push(n.instrumentId)})}function g(){H.availableCategories.splice(0,H.availableCategories.length),H.availableInstruments.splice(0,H.availableInstruments.length),H.availableSymbols.splice(0,H.availableSymbols.length),H.availableCurrencies.splice(0,H.availableCurrencies.length),z={}}function v(e){return"undefined"!=typeof z[e]}function A(e){function t(e){var t=["100","200","225","spx","h33","nas","u30","e50","f40","d30","e35","i40","z30","s30","uso","uko"];-1===n.inArray(e,H.availableCurrencies)&&-1===n.inArray(e,t)&&H.availableCurrencies.push(e)}n(e).each(function(e,o){if(!v(o.instrumentId)){H.availableInstruments.push(o),H.availableSymbols.push(o.symbol);var r=o.symbol.replace("/","");if(("FOREX"===o.type||"CFD"===o.type)&&6===r.length){var c=r.toLowerCase().substring(0,3),a=r.toLowerCase().substring(3,6);t(c),t(a)}-1===n.inArray(o.type,H.availableCategories)&&H.availableCategories.push(o.type),z[o.instrumentId]=!0}})}function I(e){var t=[];return n(e).each(function(e,n){v(n)||t.push(n)}),t}function b(){H.instrumentKeysForAccountUpdates.length&&H.instrumentKeysForAccountUpdates.splice(0,H.instrumentKeysForAccountUpdates.length)}function T(){console.log("Validating token..."),H.getAccounts().then(function(e){H.enableTrading(H.accessToken,H.authEndpoint)},function(){E(!1),O()})}function y(e,t){var o=new n.Deferred;console.log("Accounts initialized");var r,c=localStorage.getItem("selectedAccount:"+x),a=H.accounts.length-1;return r=e&&H.accounts.length>t?H.accounts[a].uniqueId:c&&H.accountMap[c]?c:H.accounts[a].uniqueId,b(),H.setSelectedAccount(r,function(){H.tradingEnabled||(E(!0),O()),o.resolve()},function(e){o.reject(e)}),o}function E(e){H.tradingEnabled=e,i()&&localStorage.setItem("tradingEnabled:"+x,H.tradingEnabled)}function O(){n(H.readyCallbacks).each(function(e,n){n()}),U("embedReady"),H.notifiedCallbacks=!0}function k(){if(H.tradingEnabled&&!X&&(W.length>0||void 0!==typeof j.accountUpdated)){X=!0;var e=[];n(H.instrumentKeysForAccountUpdates).each(function(t,o){var r=o.substring(0,o.indexOf(":"));-1===n.inArray(r,e)&&e.push(r)}),H.getSnapshot(e).then(function(e){return H.lastSnapshot=e,R(e)}).then(function(e){n.each(W,function(n,t){t(e)}),U("accountUpdated",e),X=!1},function(){X=!1})}}function R(e){var t=new n.Deferred;if(f())t.resolve(e);else{var o=[],r=function(e,n){v(n.instrumentId)||o.push(n.instrumentId)};n(e.positions.open).each(r),n(e.orders.pending).each(r),o.length?H.getInstrumentsFromIds(o).then(function(){t.resolve(e)}):t.resolve(e)}return t}function P(){H.tradingEnabled=!1,i()&&localStorage.setItem("tradingEnabled:"+x,!1),n(B).each(function(e,n){n()}),U("tokenExpired"),O()}function S(e){n(J).each(function(n,t){t(e)}),U("error",e)}function C(){n(G).each(function(e,n){n()}),U("accountSwitch")}function U(e,n){if(H.isEventValid(e)){if(void 0!==typeof j[e])for(var t in j[e])"undefined"!=typeof n?j[e][t](n):j[e][t]()}else console.error("Careful, can't notify '"+e+"', it's an invalid event name")}function w(e,n,t){return n||t?e.then(function(e){return"function"==typeof n?n(e):void 0},function(e,n,o){return"function"==typeof t?t(e,n,o):void 0}):e.promise()}function F(){var e=new n.Deferred;if(!H.tradingEnabled||H.selectedAccount.brokerId<0&&1===H.allAccounts.length)return e.resolve(),e;var t={tokenValue:H.accessToken};return H.makeOsRequest("internal","POST","","signOut",t).then(function(){e.resolve()},function(){e.reject()}),e}function q(e){var n,t,o=0;if(0===e.length)return o;for(n=0;n<e.length;n++)t=e.charCodeAt(n),o=(o<<5)-o+t,o&=o;return o}function L(){return-1!==navigator.userAgent.indexOf("MSIE")||/rv:11.0/i.test(navigator.userAgent)}("undefined"==typeof console||"undefined"==typeof console.log)&&(e.console={log:function(){}}),e.tradableConfig=o();var x=tradableConfig.appId,D=r(),M=c(D),_=a(),N=["embedReady","accountUpdated","accountSwitch","tokenExpired","tokenWillExpire","error"],j={},G=[],W=[],K=[],B=[],V=[],J=[],H={version:"1.16.1",app_id:x,oauth_host:M.oauthHost,auth_loc:M.oauthURL,login_loc:M.oauthURL+"&showLogin=true",approval_page_loc:M.oauthURL+"&showApproval=true",broker_signup_loc:"https://"+M.oauthHost+"brokerSignup?client_id="+x+"&redirect_uri="+D,auth_window:null,authEndpoint:_.authEndpoint,accessToken:_.token,tradingEnabled:_.tradingEnabled,expirationTimeUTC:_.expirationTimeUTC,notifiedCallbacks:!1,readyCallbacks:[],allAccounts:[],accounts:[],accountIdsToExclude:[],accountMap:{},selectedAccount:null,selectedAccountId:null,availableCategories:[],availableInstruments:[],availableSymbols:[],availableCurrencies:[],lastSnapshot:null,instrumentKeysForAccountUpdates:[],accountUpdateMillis:700,showApprovalPage:function(){H.openOAuthPage("APPROVAL",!0)},showApprovalPageInWindow:function(){H.openOAuthPage("APPROVAL",!1)},authenticate:function(e){H.tradingEnabled?T():H.openOAuthPage("AUTHENTICATE",!0,e)},authenticateWithWindow:function(e){H.openOAuthPage("AUTHENTICATE",!1,e)},showLoginPage:function(e){H.openOAuthPage("LOGIN",!0,e)},showLoginPageInWindow:function(e){H.openOAuthPage("LOGIN",!1,e)},showBrokerSignUpPage:function(){H.openOAuthPage("BROKER_SIGNUP",!0)},showBrokerSignUpPageInWindow:function(){H.openOAuthPage("BROKER_SIGNUP",!1)},openOAuthPage:function(e,n,t){var o="AUTHENTICATE"===e.toUpperCase()?H.auth_loc:"LOGIN"===e.toUpperCase()?H.login_loc:"APPROVAL"===e.toUpperCase()?H.approval_page_loc:"BROKER_SIGNUP"===e.toUpperCase()?H.broker_signup_loc:void 0;if(!o)return void console.error("Choose a correct type: AUTHENTICATE, LOGIN, APPROVAL or BROKER_SIGNUP");if("undefined"!=typeof t&&(o=o+"&broker_id="+t),"undefined"!=typeof n&&n||L())location.href=o;else{var r="BROKER_SIGNUP"===e.toUpperCase()?"osBrokerSignUp":"osLaunch";H.auth_window=u(o,r)}},enableWithAccessToken:function(e,n,t){return H.enableTrading(e,n,t,!0)},signOut:function(){F(),i()&&(localStorage.removeItem("accessToken:"+x),localStorage.removeItem("authEndpoint:"+x),localStorage.removeItem("tradingEnabled:"+x),localStorage.removeItem("expirationTimeUTC:"+x)),H.tradingEnabled=!1,O()},isEventValid:function(e){return"string"==typeof e&&-1!==n.inArray(e,N)},on:function(e,n,t){if(!H.isEventValid(n))return void console.error("Plase provide a valid eventName: "+N);if(j[n]||(j[n]={}),"string"!=typeof e)return void console.error("The given event namespace is invalid (needs to be a string)");if("undefined"!=typeof j[n][e])return void console.error("The given event namespace is already taken, 'off' the event first to change it");if("function"!=typeof t)return void console.error("Please provide a valid callback function");switch(n){case"embedReady":H.initEmbedReady(t);break;case"accountUpdated":H.initAccountUpdated();break;case"tokenWillExpire":H.initTokenWillExpire()}j[n][e]=t},off:function(e,n){if("undefined"==typeof n)for(var t in j)e in j[t]&&delete j[t][e];else H.isEventValid(n)&&j[n]&&e in j[n]&&delete j[n][e]},initEmbedReady:function(e){return H.notifiedCallbacks?e():void 0},onEmbedReady:function(e){H.readyCallbacks.push(e),H.initEmbedReady(e)},accountUpdateInterval:null,initAccountUpdated:function(){null===H.accountUpdateInterval&&(H.accountUpdateInterval=setInterval(k,H.accountUpdateMillis))},onAccountUpdated:function(e){if(e){H.initAccountUpdated();var t=q(e.toString());-1===n.inArray(t,K)&&(W.push(e),K.push(t))}},setAccountUpdateFrequencyMillis:function(e){e&&e>0&&"number"==typeof e?(H.accountUpdateMillis=e,H.accountUpdateInterval&&(clearInterval(H.accountUpdateInterval),H.accountUpdateInterval=setInterval(k,H.accountUpdateMillis))):console.error("Please specify a valid update frequency")},addSymbolToUpdates:function(e,n){console.warn("'addSymbolToUpdates' is now deprecated, 'addInstrumentIdToUpdates' should now be used instead."),H.addInstrumentIdToUpdates(e,n)},removeSymbolFromUpdates:function(e,n){console.warn("'removeSymbolFromUpdates' is now deprecated, 'removeInstrumentIdFromUpdates' should now be used instead."),H.removeInstrumentIdFromUpdates(e,n)},addInstrumentIdToUpdates:function(e,t){if(-1!==e.indexOf(":"))return void console.error("It is not allowed to include a colon ':' in the updateClientId");var o=t+":"+e;-1===n.inArray(o,H.instrumentKeysForAccountUpdates)&&H.instrumentKeysForAccountUpdates.push(o)},removeInstrumentIdFromUpdates:function(e,t){var o=t+":"+e;H.instrumentKeysForAccountUpdates=n.grep(H.instrumentKeysForAccountUpdates,function(e){return e!==o})},onAccountSwitch:function(e){H.saveCallback(e,G)},onTokenExpired:function(e){H.saveCallback(e,B)},onError:function(e){H.saveCallback(e,J)},saveCallback:function(e,t){e&&-1===n.inArray(e,t)&&t.push(e)},tokenWillExpireInterval:null,initTokenWillExpire:function(){function e(){var e=H.getRemainingTokenMillis();e&&e>0&&18e5>e&&(n(V).each(function(n,t){t(e)}),U("tokenWillExpire",e))}null===H.tokenWillExpireInterval&&(H.tokenWillExpireInterval=setInterval(e,3e5))},onTokenWillExpire:function(e){H.initTokenWillExpire(),-1===n.inArray(e,V)&&V.push(e)},getRemainingTokenMillis:function(){return H.expirationTimeUTC||console.log("You need to authenticate before calling this method"),H.expirationTimeUTC-(new Date).getTime()},makeOsRequest:function(e,t,o,r,c,a,i){var u,s="internal"===e?"":"v1/";"user"!==e&&"accounts"!==e?u="https://"+H.oauth_host:void 0!==o&&null!==o&&0===o.length?u=H.authEndpoint:H.accountMap[o]?u=H.accountMap[o].endpointURL:console.info("Please specify a valid accountId or method");var l=n.ajax({type:t,beforeSend:function(n){"internal"!==e&&n.setRequestHeader("Authorization","Bearer "+H.accessToken),n.setRequestHeader("x-tr-embed-sdk","js-"+H.version)},crossDomain:!0,xhrFields:{withCredentials:!0},url:o&&o.length>0?u+s+e+"/"+o+"/"+r:u+s+e+"/"+r,contentType:"application/json; charset=utf-8",data:c?JSON.stringify(c):void 0,dataType:"json"});return l.then(function(){},function(e,n,t){e.responseJSON&&((403===e.responseJSON.httpStatus||502===e.responseJSON.httpStatus)&&P(),S(e.responseJSON))}),w(l,a,i)},makeAccountRequest:function(e,n,t,o,r,c){return H.makeOsRequest("accounts",e,n,t,o,r,c)},setSelectedAccount:function(e,n,t){return H.accountMap[e]?(H.lastSnapshot=void 0,H.selectedAccount=H.accountMap[e],H.selectedAccountId=e,console.log("New accountId is set"),s(function(){i()&&localStorage.setItem("selectedAccount:"+x,e),n&&n()},function(e){(502===e.status||500===e.status||403===e.status)&&(H.excludeCurrentAccount(),H.accounts.length>0?T():H.signOut()),t&&t(e)})):void console.error("Can't set account id to: "+e)},excludeCurrentAccount:function(){var e=H.selectedAccountId,n=H.accounts.indexOf(H.selectedAccount);n>-1&&H.accounts.splice(n,1),delete H.accountMap[e],H.accountIdsToExclude.push(e)},getInstrumentFromSymbol:function(e){return e?H.getInstrumentForProperty(H.availableInstruments,"symbol",e):null},getInstrumentFromId:function(e){return e?v(e)?H.getInstrumentForProperty(H.availableInstruments,"instrumentId",e):(console.warn("Instrument Id not found..."),null):null},getInstrumentFromBrokerageAccountSymbol:function(e){return H.getInstrumentForProperty(H.availableInstruments,"brokerageAccountSymbol",e)},getInstrumentForProperty:function(e,t,o){var r=null;return n(e).each(function(e,n){return n[t].toUpperCase()===o.toUpperCase()?(r=n,!1):void 0}),r},getAccountById:function(e){return H.accountMap[e]},getUser:function(e,n){return H.makeOsRequest("user","GET","","",null,e,n)},getAppInfo:function(e,n){return H.makeOsRequest("apps","GET","",H.app_id,null,e,n)},getBrokers:function(e,n){return H.makeOsRequest("brokers","GET","","",null,e,n)},authenticateWithCredentials:function(e,t,o,r,c){var a=new n.Deferred,i={appId:H.app_id,brokerId:e,login:t,password:o};return H.makeAuthenticationRequest(a,"authenticate",i),w(a,r,c)},createDemoAccount:function(e,t,o){var r=new n.Deferred,c={appId:H.app_id,type:e};return H.makeAuthenticationRequest(r,"createDemoAccount",c),w(r,t,o)},makeAuthenticationRequest:function(e,n,t){var o;return H.makeOsRequest(n,"POST","","",t).then(function(e){return o=e,H.enableTrading(e.apiTokenValue,e.apiEndpoint,e.expires)}).then(function(){e.resolve(o)},function(n){e.reject(n)})},createForexDemoAccount:function(e,n){return H.createDemoAccount("FOREX",e,n)},createStocksDemoAccount:function(e,n){return H.createDemoAccount("STOCKS",e,n)},refreshAuthentication:function(e,t,o,r){var c=new n.Deferred,a={refreshTokenValue:e};return t&&(a={refreshTokenValue:e,appSecret:t}),H.makeAuthenticationRequest(c,"refreshAuthentication",a),w(c,o,r)},getAccounts:function(e,t){var o=H.makeAccountRequest("GET","","",null).then(function(e){H.accounts.splice(0,H.accounts.length),H.allAccounts.splice(0,H.allAccounts.length),H.accountMap={},n(e.accounts).each(function(e,n){n.uniqueId&&"NA"!==n.uniqueId&&H.accountIdsToExclude.indexOf(n.uniqueId)<=-1&&(H.accounts.push(n),H.accountMap[n.uniqueId]=n),H.allAccounts.push(n)})});return w(o,e,t)},getCandles:function(e,n,t,o,r,c){return H.getCandlesForAccount(H.selectedAccountId,e,n,t,o,r,c)},getCandlesForAccount:function(e,n,t,o,r,c,a){var i={instrumentId:n,from:t,to:o,aggregation:r};return H.makeAccountRequest("POST",e,"candles/",i,c,a)},subscribedCandleId:void 0,lastReceivedCandle:void 0,startCandleUpdates:function(e,t,o,r){function c(){H.on("internalCandleUpdates","accountUpdated",function(t){var o=i(e,t.prices);if(H.lastReceivedCandle&&o&&o.bid){var c=JSON.stringify(n.extend({},H.lastReceivedCandle));if(a(o,u),c!==JSON.stringify(H.lastReceivedCandle)){var s=[];return s.push(H.lastReceivedCandle),r(s)}}})}function a(e,n){var t=e.bid;if(Date.now()-H.lastReceivedCandle.timestamp>=n){H.lastReceivedCandle.timestamp=H.lastReceivedCandle.timestamp+n;var o=H.lastReceivedCandle.close;H.lastReceivedCandle.open=o,H.lastReceivedCandle.high=o,H.lastReceivedCandle.low=o}H.lastReceivedCandle.close=t,t>H.lastReceivedCandle.high&&(H.lastReceivedCandle.high=t),t<H.lastReceivedCandle.low&&(H.lastReceivedCandle.low=t)}function i(e,t){var o=null;return n(t).each(function(n,t){return t.instrumentId===e?(o=t,!1):void 0}),o}H.stopCandleUpdates();var u=60*o*1e3;H.subscribedCandleId=e,H.addInstrumentIdToUpdates("internalCandleUpdates",H.subscribedCandleId),H.getCandles(e,t,Date.now(),o).then(function(e){return H.lastReceivedCandle=e.candles[e.candles.length-1],c(),r(e.candles)},function(e){S(e.responseJSON)})},stopCandleUpdates:function(){H.subscribedCandleId&&(H.removeInstrumentIdFromUpdates("internalCandleUpdates",H.subscribedCandleId),H.off("internalCandleUpdates"),H.subscribedCandleId=void 0,H.lastReceivedCandle=void 0)},getSnapshot:function(e,n,t){return H.getSnapshotForAccount(H.selectedAccountId,e,n,t)},getSnapshotForAccount:function(e,n,t,o){var r={instrumentIds:n,includeMarginFactors:!1};return H.makeAccountRequest("POST",e,"",r,t,o)},getInstrumentsFromIds:function(e,n,t){return H.getInstrumentsFromIdsForAccount(H.selectedAccountId,e,n,t)},getInstrumentsFromIdsForAccount:function(e,t,o,r){var c=new n.Deferred,a=[];p(e)||(a=I(t));var i=new n.Deferred;if(a.length){var u={instrumentIds:a};H.makeAccountRequest("POST",e,"instruments/",u).then(function(e){A(e.instruments),i.resolve(H.availableInstruments)})}else H.getOrResolveInstrumentsForAccountId(e,i,c);return i.then(function(e){var o=[];n(t).each(function(n,t){var r=H.getInstrumentForProperty(e,"instrumentId",t);r&&o.push(r)}),c.resolve({instruments:o})},function(e){c.reject(e)}),w(c,o,r)},getOrResolveInstrumentsForAccountId:function(e,n,t){H.selectedAccount&&e===H.selectedAccount.uniqueId?n.resolve(H.availableInstruments):d(e).then(function(e){n.resolve(e)},function(e){t.reject(e)})},searchInstruments:function(e,n,t){return H.searchInstrumentsForAccount(H.selectedAccountId,e,n,t)},searchInstrumentsForAccount:function(e,t,o,r){function c(e,t){var o=new RegExp(a(t),"i"),r=n.grep(e,function(e){return o.test(e.symbol)||o.test(e.brokerageAccountSymbol)||o.test(e.displayName)||o.test(e.type)});return r}function a(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function i(e){var t=n.extend({},e),o=["instrumentId","symbol","brokerageAccountSymbol","displayName","shortDescription","type"],r=[];for(var c in t)n.inArray(c,o)<0&&r.push(c);return n(r).each(function(e,n){delete t[n]}),t}var u=new n.Deferred;if(p(e)){var s=new n.Deferred;H.getOrResolveInstrumentsForAccountId(e,s,u),s.then(function(e){var o=c(e,t),r=[];n(o).each(function(e,n){r.push(i(n))}),u.resolve(r)},function(e){u.reject(e)})}else{var l={query:t};t.length<2?u.resolve([]):H.makeAccountRequest("POST",e,"instrumentsearch/",l).then(function(e){u.resolve(e.instruments)},function(e){u.reject(e)})}return w(u,o,r)},getMetrics:function(e,n){return H.getMetricsForAccount(H.selectedAccountId,e,n)},getMetricsForAccount:function(e,n,t){return H.makeAccountRequest("GET",e,"metrics/",null,n,t)},getOrders:function(e,n){return H.getOrdersForAccount(H.selectedAccountId,e,n)},getOrdersForAccount:function(e,n,t){return H.makeAccountRequest("GET",e,"orders/",null,n,t)},placeMarketOrder:function(e,n,t,o,r){return H.placeOrder(e,0,n,t,"MARKET",o,r)},placeMarketOrderForAccount:function(e,n,t,o,r,c){return H.placeOrderForAccount(e,n,0,t,o,"MARKET",r,c)},placeLimitOrder:function(e,n,t,o,r,c){return H.placeOrder(e,n,t,o,"LIMIT",r,c)},placeLimitOrderForAccount:function(e,n,t,o,r,c,a){return H.placeOrderForAccount(e,n,t,o,r,"LIMIT",c,a)},placeStopOrder:function(e,n,t,o,r,c){return H.placeOrder(e,n,t,o,"STOP",r,c)},placeStopOrderForAccount:function(e,n,t,o,r,c,a){return H.placeOrderForAccount(e,n,t,o,r,"STOP",c,a)},placeOrder:function(e,n,t,o,r,c,a){return H.placeOrderForAccount(H.selectedAccountId,e,n,t,o,r,c,a)},placeOrderForAccount:function(e,n,t,o,r,c,a,i){var u={amount:n,price:t,side:o,instrumentId:r,type:c};return H.makeAccountRequest("POST",e,"orders/",u,a,i)},placeOrderWithProtections:function(e,n,t,o,r,c,a,i,u){return H.placeOrderWithProtectionsForAccount(H.selectedAccountId,e,n,t,o,r,c,a,i,u)},placeOrderWithProtectionsForAccount:function(e,n,t,o,r,c,a,i,u,s){var l={amount:n,price:t,side:o,instrumentId:r,type:c};return a&&(l.takeProfitDistance=a),i&&(l.stopLossDistance=i),H.makeAccountRequest("POST",e,"orders/",l,u,s)},getPendingOrders:function(e,n){return H.getPendingOrdersForAccount(H.selectedAccountId,e,n)},getPendingOrdersForAccount:function(e,n,t){return H.makeAccountRequest("GET",e,"orders/pending",null,n,t)},getOrderById:function(e,n,t){return H.getOrderByIdForAccount(H.selectedAccountId,e,n,t)},getOrderByIdForAccount:function(e,n,t,o){return H.makeAccountRequest("GET",e,"orders/"+n,null,t,o)},modifyOrderPrice:function(e,n,t,o){return H.modifyOrderPriceForAccount(H.selectedAccountId,e,n,t,o)},modifyOrderPriceForAccount:function(e,n,t,o,r){return H.makeAccountRequest("PUT",e,"orders/"+n,{price:t},o,r)},cancelOrder:function(e,n,t){return H.cancelOrderForAccount(H.selectedAccountId,e,n,t)},cancelOrderForAccount:function(e,n,t,o){return H.makeAccountRequest("DELETE",e,"orders/"+n,null,t,o)},getPositions:function(e,n){return H.getPositionsForAccount(H.selectedAccountId,e,n)},getPositionsForAccount:function(e,n,t){return H.makeAccountRequest("GET",e,"positions/",null,n,t)},closeAllPositions:function(e,n){return H.closeAllPositionsForAccount(H.selectedAccountId,e,n)},closeAllPositionsForAccount:function(e,n,t){return H.makeAccountRequest("DELETE",e,"positions/",null,n,t)},getOpenPositions:function(e,n){return H.getOpenPositionsForAccount(H.selectedAccountId,e,n)},getOpenPositionsForAccount:function(e,n,t){return H.makeAccountRequest("GET",e,"positions/open",null,n,t)},getPositionById:function(e,n,t){return H.getPositionByIdForAccount(H.selectedAccountId,e,n,t)},getPositionByIdForAccount:function(e,n,t,o){return H.makeAccountRequest("GET",e,"positions/"+n,null,t,o)},reducePositionToAmount:function(e,n,t,o){return H.reducePositionToAmountForAccount(H.selectedAccountId,e,n,t,o)},reducePositionToAmountForAccount:function(e,n,t,o,r){var c={amount:t};return H.makeAccountRequest("PUT",e,"positions/"+n,c,o,r)},closePosition:function(e,n,t){return H.closePositionForAccount(H.selectedAccountId,e,n,t)},closePositionForAccount:function(e,n,t,o){return H.makeAccountRequest("DELETE",e,"positions/"+n,null,t,o)},addOrModifyProtections:function(e,n,t,o,r){return H.addOrModifyProtectionsForAccount(H.selectedAccountId,e,n,t,o,r)},addOrModifyProtectionsForAccount:function(e,n,t,o,r,c){var a={};return null!==t&&(a.takeprofit=t),null!==o&&(a.stoploss=o),H.makeAccountRequest("PUT",e,"positions/"+n+"/protections/",a,r,c)},cancelProtections:function(e,n,t){return H.cancelProtectionsForAccount(H.selectedAccountId,e,n,t)},cancelProtectionsForAccount:function(e,n,t,o){return H.makeAccountRequest("DELETE",e,"positions/"+n+"/protections/",null,t,o)},addOrModifyTakeProfit:function(e,n,t,o){return H.makeProtectionRequest("PUT",e,n,"TAKEPROFIT",t,o)},addOrModifyTakeProfitForAccount:function(e,n,t,o,r){return H.makeProtectionRequestForAccount("PUT",e,n,t,"TAKEPROFIT",o,r)},addOrModifyStopLoss:function(e,n,t,o){return H.makeProtectionRequest("PUT",e,n,"STOPLOSS",t,o)},addOrModifyStopLossForAccount:function(e,n,t,o,r){return H.makeProtectionRequestForAccount("PUT",e,n,t,"STOPLOSS",o,r)},cancelTakeProfit:function(e,n,t){return H.makeProtectionRequest("DELETE",e,0,"TAKEPROFIT",n,t)},cancelTakeProfitForAccount:function(e,n,t,o){return H.makeProtectionRequestForAccount("DELETE",e,n,0,"TAKEPROFIT",t,o)},cancelStopLoss:function(e,n,t){return H.makeProtectionRequest("DELETE",e,0,"STOPLOSS",n,t)},cancelStopLossForAccount:function(e,n,t,o){return H.makeProtectionRequestForAccount("DELETE",e,n,0,"STOPLOSS",t,o)},makeProtectionRequest:function(e,n,t,o,r,c){return H.makeProtectionRequestForAccount(e,H.selectedAccountId,n,t,o,r,c)},makeProtectionRequestForAccount:function(e,n,t,o,r,c,a){var i={price:o};return"DELETE"===e&&(i=null),H.makeAccountRequest(e,n,"positions/"+t+"/protections/"+r,i,c,a)},getPrices:function(e,n,t){return H.getPricesForAccount(H.selectedAccountId,e,n,t)},getPricesForAccount:function(e,t,o,r){var c={instrumentIds:t};if(p(e)||e!==H.selectedAccount.uniqueId)return H.makeAccountRequest("POST",e,"prices/",c,o,r);var a,i=new n.Deferred,u=I(t);return a=u.length?H.getInstrumentsFromIdsForAccount(e,u).then(function(){return H.makeAccountRequest("POST",e,"prices/",c)}):H.makeAccountRequest("POST",e,"prices/",c),a.then(function(e){i.resolve(e)},function(e){i.reject(e)}),w(i,o,r)},makeCandleRequest:function(e,t,o,r,c){var a={symbols:t};c&&(a=c);var i=n.ajax({type:"POST",crossDomain:!0,url:"https://candles-api.tradable.com/"+e,contentType:"application/json; charset=utf-8",data:JSON.stringify(a),dataType:"json"});if(o||r)return i.then(function(e){return"function"==typeof o?o(e.dailyClose?e.dailyClose:e):void 0},function(e,n,t){return"function"==typeof r?r(e,n,t):void 0});var u=new n.Deferred;return i.then(function(e){return e.dailyClose?u.resolve(e.dailyClose):u.resolve(e)},function(e,n,t){return u.reject(e,n,t)}),"undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]")?Promise.resolve(u.promise()):u.promise()},getLastDailyClose:function(e,n,t){return H.makeCandleRequest("dailyClose",e,n,t)},initializeWithToken:function(e,n,t,o,r){e&&n&&(H.accessToken=e,H.authEndpoint=n,i()&&(localStorage.setItem("accessToken:"+x,H.accessToken),localStorage.setItem("authEndpoint:"+x,H.authEndpoint),t&&(H.expirationTimeUTC=(new Date).getTime()+1e3*parseInt(t,10),localStorage.setItem("expirationTimeUTC:"+x,H.expirationTimeUTC))));var c=H.getAccounts();return w(c,o,r)},enableTrading:function(e,t,o,r){var c=new n.Deferred;console.log("Enabling Trading..."),H.tradingEnabled=!1,H.lastSnapshot=void 0;var a=H.accounts.length;return H.initializeWithToken(e,t,o).then(function(e){return y(r,a)}).then(function(){c.resolve()},function(e){c.reject(e)}),c}};t();var Q=[],z={},X=!1;e.trEmbJQ=trEmbJQ,e.tradable=H,e.tradableEmbed=H,"function"==typeof require&&"object"==typeof module&&module&&module.exports&&(module.exports=H)}(jsGlobalObject,trEmbJQ);